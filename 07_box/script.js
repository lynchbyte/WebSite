import*as THREE from"https://unpkg.com/three@0.131.1/build/three.module.js";import{OrbitControls}from"./OrbitControls.js";const scene=new THREE.Scene,pts=[],fall=[],bodys=[],camera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.1,1200),renderer=new THREE.WebGLRenderer({antialias:!0}),clock=new THREE.Clock;var world,mass,body,shape,timeStep=1/60;let hometime=!1,currentTime=0;function initCannon(){(world=new CANNON.World).gravity.set(0,-50,0),world.broadphase=new CANNON.NaiveBroadphase,world.solver.iterations=10,world.name="World";var e=new CANNON.Plane,t=new CANNON.Body({mass:0});t.addShape(e),t.quaternion.setFromAxisAngle(new CANNON.Vec3(1,0,0),-Math.PI/2),world.add(t);for(var s=new CANNON.Box(new CANNON.Vec3(1,1,1)),o=0;o<pts.length;o++){let e=pts[o];var n=new CANNON.Body({mass:1});n.addShape(s),n.position.set(e.x,e.y,e.z),world.add(n),bodys.push(n)}setTimeout((function(){goHome()}),5e3)}function goHome(){for(var e=0;e<bodys.length;e++){let t=bodys[e];world.remove(t)}hometime=!0}function init(){const e=document.createElement("div");document.body.appendChild(e),camera.position.set(0,21.1,18);const t=new OrbitControls(camera,e);t.target.set(0,20,0),t.update(),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.shadowMap.enabled=!0,e.appendChild(renderer.domElement);const s=new THREE.Color(3933736);scene.background=new THREE.Color(s),addLights(),addFloor(),makePts(),makeMesh(),window.addEventListener("resize",onWindowResize,!1)}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){renderer.setAnimationLoop(render)}function update(){const e=clock.getDelta();if(null!=world){world.step(timeStep);for(let e=0;e<fall.length;e++){var t=fall[e],s=bodys[e];t.position.copy(s.position),t.quaternion.copy(s.quaternion),t.receiveShadow=!0}0!=hometime&&lerpit(e)}}function lerpit(e){for(let t=0;t<fall.length;t++){let s=fall[t],o=new THREE.Vector3,n=new THREE.Vector3(s.position.x,s.position.y,s.position.z),r=new THREE.Vector3(s.userData.homePosX,s.userData.homePosY,s.userData.homePosZ);currentTime+=e;let p=currentTime/400;p<.99?(o.lerpVectors(n,r,p),s.position.copy(o)):(s.position.set(s.userData.homePosX,s.userData.homePosY,s.userData.homePosZ),s.receiveShadow=!1),s.rotation.set(s.userData.homeRotX,s.userData.homeRotY,s.userData.homeRotZ)}}function render(){update(),renderer.render(scene,camera)}function addLights(){const e=new THREE.HemisphereLight(16777215,4473924);e.position.set(0,20,0),scene.add(e);const t=new THREE.DirectionalLight(16777215,.2);t.position.set(-0,10,10),t.castShadow=!0,t.shadow.camera.top=40,t.shadow.camera.bottom=-30,t.shadow.camera.left=-50,t.shadow.camera.right=50,t.shadow.camera.near=.1,t.shadow.camera.far=80,scene.add(t)}function addFloor(){const e=new THREE.PlaneBufferGeometry(200,100,1,1),t=new THREE.Color(3933736),s=new THREE.MeshPhongMaterial({color:t}),o=new THREE.Mesh(e,s);o.rotation.set(Math.PI/180*-90,0,0),o.position.set(0,0,-35),o.receiveShadow=!0,o.name="Floor",scene.add(o)}function makePts(){const e=-25;pts.push(new THREE.Vector3(-9.5,30,e)),pts.push(new THREE.Vector3(-9.5,29,e)),pts.push(new THREE.Vector3(-9.5,28,e)),pts.push(new THREE.Vector3(-9.5,27,e)),pts.push(new THREE.Vector3(-9.5,26,e)),pts.push(new THREE.Vector3(-9.5,25,e)),pts.push(new THREE.Vector3(-8.5,25,e)),pts.push(new THREE.Vector3(-7.5,25,e)),pts.push(new THREE.Vector3(-7.5,21,e)),pts.push(new THREE.Vector3(-7.5,20,e)),pts.push(new THREE.Vector3(-7.5,19,e)),pts.push(new THREE.Vector3(-7.5,18,e)),pts.push(new THREE.Vector3(-7.5,17,e)),pts.push(new THREE.Vector3(-7.5,16,e)),pts.push(new THREE.Vector3(-7.5,15,e)),pts.push(new THREE.Vector3(-6.5,25,e)),pts.push(new THREE.Vector3(-6.5,21,e)),pts.push(new THREE.Vector3(-6.5,18,e)),pts.push(new THREE.Vector3(-6.5,15,e)),pts.push(new THREE.Vector3(-5.5,21,e)),pts.push(new THREE.Vector3(-5.5,18,e)),pts.push(new THREE.Vector3(-5.5,15,e)),pts.push(new THREE.Vector3(-4.5,27,e)),pts.push(new THREE.Vector3(-4.5,26,e)),pts.push(new THREE.Vector3(-4.5,25,e)),pts.push(new THREE.Vector3(-4.5,23,e)),pts.push(new THREE.Vector3(-4.5,21,e)),pts.push(new THREE.Vector3(-4.5,20,e)),pts.push(new THREE.Vector3(-4.5,19,e)),pts.push(new THREE.Vector3(-4.5,18,e)),pts.push(new THREE.Vector3(-4.5,17,e)),pts.push(new THREE.Vector3(-4.5,16,e)),pts.push(new THREE.Vector3(-4.5,15,e)),pts.push(new THREE.Vector3(-3.5,25,e)),pts.push(new THREE.Vector3(-3.5,23,e)),pts.push(new THREE.Vector3(-2.5,27,e)),pts.push(new THREE.Vector3(-2.5,26,e)),pts.push(new THREE.Vector3(-2.5,25,e)),pts.push(new THREE.Vector3(-2.5,24,e)),pts.push(new THREE.Vector3(-2.5,23,e)),pts.push(new THREE.Vector3(-2.5,17,e)),pts.push(new THREE.Vector3(-2.5,16,e)),pts.push(new THREE.Vector3(-2.5,15,e)),pts.push(new THREE.Vector3(-1.5,15,e)),pts.push(new THREE.Vector3(-1.5,13,e)),pts.push(new THREE.Vector3(-.5,27,e)),pts.push(new THREE.Vector3(-.5,26,e)),pts.push(new THREE.Vector3(-.5,25,e)),pts.push(new THREE.Vector3(-.5,17,e)),pts.push(new THREE.Vector3(-.5,16,e)),pts.push(new THREE.Vector3(-.5,15,e)),pts.push(new THREE.Vector3(-.5,14,e)),pts.push(new THREE.Vector3(-.5,13,e)),pts.push(new THREE.Vector3(.5,27,e)),pts.push(new THREE.Vector3(1.5,27,e)),pts.push(new THREE.Vector3(1.5,26,e)),pts.push(new THREE.Vector3(1.5,25,e)),pts.push(new THREE.Vector3(1.5,19,e)),pts.push(new THREE.Vector3(2.5,20,e)),pts.push(new THREE.Vector3(2.5,19,e)),pts.push(new THREE.Vector3(2.5,18,e)),pts.push(new THREE.Vector3(2.5,17,e)),pts.push(new THREE.Vector3(2.5,16,e)),pts.push(new THREE.Vector3(2.5,15,e)),pts.push(new THREE.Vector3(3.5,27,e)),pts.push(new THREE.Vector3(3.5,26,e)),pts.push(new THREE.Vector3(3.5,25,e)),pts.push(new THREE.Vector3(3.5,19,e)),pts.push(new THREE.Vector3(4.5,27,e)),pts.push(new THREE.Vector3(4.5,25,e)),pts.push(new THREE.Vector3(5.5,27,e)),pts.push(new THREE.Vector3(5.5,25,e)),pts.push(new THREE.Vector3(5.5,19,e)),pts.push(new THREE.Vector3(5.5,18,e)),pts.push(new THREE.Vector3(5.5,17,e)),pts.push(new THREE.Vector3(5.5,16,e)),pts.push(new THREE.Vector3(5.5,15,e)),pts.push(new THREE.Vector3(6.5,19,e)),pts.push(new THREE.Vector3(6.5,17,e)),pts.push(new THREE.Vector3(6.5,15,e)),pts.push(new THREE.Vector3(7.5,29,e)),pts.push(new THREE.Vector3(7.5,28,e)),pts.push(new THREE.Vector3(7.5,27,e)),pts.push(new THREE.Vector3(7.5,26,e)),pts.push(new THREE.Vector3(7.5,25,e)),pts.push(new THREE.Vector3(7.5,19,e)),pts.push(new THREE.Vector3(7.5,15,e)),pts.push(new THREE.Vector3(8.5,27,e)),pts.push(new THREE.Vector3(9.5,27,e)),pts.push(new THREE.Vector3(9.5,26,e)),pts.push(new THREE.Vector3(9.5,25,e))}function makeMesh(){const e=new THREE.MeshLambertMaterial({color:16734783}),t=new THREE.BoxBufferGeometry(1,1,1);for(let s=0;s<pts.length;s++){let o=pts[s];const n=new THREE.Mesh(t,e);n.position.set(o.x,o.y,o.z),n.rotation.set(0,0,0),n.userData={homePosX:o.x,homePosY:o.y,homePosZ:o.z,homeRotX:0,homeRotY:0,homeRotZ:0},n.name="mesh"+s,n.castShadow=!0,n.receiveShadow=!1,scene.add(n),fall.push(n)}}init(),animate(),setTimeout((function(){initCannon()}),3e3);